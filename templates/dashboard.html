{% extends "base.html" %}
{% block page_title %}{{ page_title }}{% endblock %}

{% block content %}
<h3>Dashboard</h3>

<!-- KPI cards: basic stats -->
<div class="row text-center mb-4">
  <div class="col-md-2">
    <div class="p-2 border rounded">
      <strong>Total Searches</strong><br>
      {{ stats.total_searches }}
    </div>
  </div>
  <div class="col-md-2">
    <div class="p-2 border rounded">
      <strong>Total Clicks</strong><br>
      {{ stats.total_clicks }}
    </div>
  </div>
  <div class="col-md-2">
    <div class="p-2 border rounded">
      <strong>CTR</strong><br>
      {{ stats.ctr }}
    </div>
  </div>
  <div class="col-md-3">
    <div class="p-2 border rounded">
      <strong>Unique Queries</strong><br>
      {{ stats.unique_queries }}
    </div>
  </div>
  <div class="col-md-3">
    <div class="p-2 border rounded">
      <strong>Unique Terms</strong><br>
      {{ stats.unique_terms }}
    </div>
  </div>
</div>

<!-- KPI cards: funnel / engagement -->
<div class="row text-center mb-4">
  <div class="col-md-3">
    <div class="p-2 border rounded">
      <strong>Searches</strong><br>
      {{ funnel.searches }}
    </div>
  </div>
  <div class="col-md-3">
    <div class="p-2 border rounded">
      <strong>Clicks</strong><br>
      {{ funnel.clicks }}
    </div>
  </div>
  <div class="col-md-3">
    <div class="p-2 border rounded">
      <strong>Dwell ≥ 5s</strong><br>
      {{ funnel.dwell_over_5s }}
    </div>
  </div>
  <div class="col-md-3">
    <div class="p-2 border rounded">
      <strong>Engagement rate</strong><br>
      {{ funnel.engagement_rate }}
    </div>
  </div>
</div>

<hr>

<!-- Charts -->
<h5>Top Clicked Products</h5>
<iframe src="/plot_number_of_views" width="100%" height="420" style="border:none;"></iframe>

<hr>

<h5>Top Queries</h5>
<iframe src="/plot_top_queries" width="100%" height="420" style="border:none;"></iframe>

<hr>

<h5>Top Query Terms</h5>
<iframe src="/plot_top_terms" width="100%" height="420" style="border:none;"></iframe>

<hr>

<h5>Searches per Hour of Day</h5>
<iframe src="/plot_search_hourly" width="100%" height="420" style="border:none;"></iframe>

<hr>

<h5>Term Co-occurrence Heatmap</h5>
<iframe src="/plot_term_heatmap" width="100%" height="420" style="border:none;"></iframe>

<hr>

<!-- User journeys (sessions) -->
<h5>User Journeys (Session Paths)</h5>
{% if paths %}
  <ul>
    {% for sid, seq in paths.items() %}
      <li>
        <code>{{ sid }}</code> :
        {{ " → ".join(seq) }}
      </li>
    {% endfor %}
  </ul>
{% else %}
  <p class="text-muted">No sessions recorded yet.</p>
{% endif %}

<hr>

<!-- Intent clusters -->
<h5>Query Intent Clusters</h5>
{% if intents %}
  <ul>
    {% for key, count in intents %}
      <li>
        <strong>{{ count }}</strong> searches &mdash; {{ key }}
      </li>
    {% endfor %}
  </ul>
{% else %}
  <p class="text-muted">No queries yet to build clusters.</p>
{% endif %}

{% endblock %}
